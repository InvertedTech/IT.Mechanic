@page "/create/dns"
@using IT.Mechanic.App.Services.Profiles
@using IT.Mechanic.App.Services.Settings
@using IT.Mechanic.Models.Configuration
@using IT.Mechanic.Models.Configuration.Credentials
@inject NavigationManager Navigation
@inject IProfileFactory ProfileFactory
@inject ICredentialService Credentials
@inject IProfileService Profiles

<MudAppBar>
    <MudText>Configure DNS</MudText>
</MudAppBar>
<MudTabs @ref="Tabs">
    <MudTabPanel Text="Provider" @ref="ProviderTab" @ID="@("#Provider")">
        <MudPaper Width="300">
            <MudCard Elevation="20" Width="75%" Class="mx-auto">
                <MudCardHeader>
                    <MudText Typo="Typo.h4">Select DNS Provider</MudText>
                </MudCardHeader>
                <MudCardContent>
                    <MudText Typo="Typo.h6">This Is Where You Bought The Domain From.</MudText>
                    @* <IT.Mechanic.App.Components.Pickers.DNSHostPicker  DNSProviderValue="@DNS.Provider" /> *@
                    <MudSelect T="DNSModel.ProviderEnum" Label="DNS Hosts" Value="@DNS.Provider">
                        @foreach (var provider in DNSModel.GetDomainNameProvidersNames())
                        {
                            <MudSelectItem Value="DNSModel.GetProviderFromName(provider)">@provider</MudSelectItem>
                        }
                    </MudSelect>
                </MudCardContent>
                <MudCardActions>
                    <MudButton @onclick="OnBackClicked">
                        <MudText Typo="@Typo.button">Back</MudText>
                    </MudButton>
                    <MudButton @onclick="() => Activate(1)">
                        <MudText Typo="@Typo.button">Next</MudText>
                    </MudButton>
                </MudCardActions>
            </MudCard>
        </MudPaper>
    </MudTabPanel>
    <MudTabPanel Text="Credentials" @ref="CredentialsTab" @ID="@("#Credentials")">
        <IT.Mechanic.App.Components.Pickers.GodaddyCredentialsPicker CredentialsService="Credentials" />
        <MudButton @onclick="() => Activate(0)">
            <MudText Typo="@Typo.button">Back</MudText>
        </MudButton><MudButton @onclick="() => Activate(2)">
            <MudText Typo="@Typo.button">Next</MudText>
        </MudButton>
    </MudTabPanel>
    <MudTabPanel Text="Domain Name" @ref="DomainNameTabPanel" @ID="@("#Domain")">
        @* <IT.Mechanic.App.Components.Pickers.DomainNamePicker DomainName="@DNS.DomainName" /> *@
        <MudSelect @bind-Value="@DNS.DomainName">
            @foreach (var Domain in _domains)
            {
                <MudSelectItem Value="@Domain" />
            }
        </MudSelect>

        <MudButton @onclick="() => Activate(1)">
            <MudText Typo="@Typo.button">Back</MudText>
        </MudButton>
        <MudButton @onclick="OnNextClicked">
            <MudText Typo="@Typo.button">Next</MudText>
        </MudButton>
    </MudTabPanel>
</MudTabs>

@code {
    public DNSModel DNS { get; set; } = new();

    private MudTabs Tabs;
    private MudTabPanel ProviderTab;
    private MudTabPanel CredentialsTab;
    private MudTabPanel DomainNameTabPanel;

    private List<string> _domains = ["example1.com", "example2.com", "example3.com"];


    private enum DNSTabs
    {
        Provider,
        DomainName,
        Credentials
    }

    private void Activate(int index)
    {
        Tabs.ActivatePanel(index);
    }

    private void OnBackClicked()
    {
        Navigation.NavigateTo("/create");
    }

    private void OnNextClicked()
    {
        ProfileFactory.DNS = DNS;
        Navigation.NavigateTo("/create/hosting");
    }
}
