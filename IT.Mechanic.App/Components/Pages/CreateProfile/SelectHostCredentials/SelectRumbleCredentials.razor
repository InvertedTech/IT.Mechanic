@using IT.Mechanic.App.Services.Profiles
@using IT.Mechanic.App.Services.Settings
@using IT.Mechanic.Models.Configuration
@using IT.Mechanic.Models.Configuration.App
@using IT.Mechanic.Models.Configuration.Credentials
@page "/create/select-server-host-credentials/Rumble"
@inject IProfileFactory ProfileFactory;
@inject ICredentialService CredentialService;
@inject NavigationManager Navigation;

<MudText Typo="Typo.h4">Select Host Provider Credentials</MudText>
<MudPaper Width="300">
    <MudText Typo="Typo.h6">Select Host Provider Credentials For @Host</MudText>

        <MudSelect T="RumbleModel" Label=@($"{Host} Credentials") @bind-Value="SelectedCredential">
            @foreach (var credentialRecord in CredentialService.CredentialsState.RumbleCredentials)
        {
            <MudSelectItem Value="@credentialRecord.Credentials">@credentialRecord.CredentialName</MudSelectItem>
        }
    </MudSelect>
</MudPaper>
<MudButtonGroup Variant="Variant.Filled">
    <MudButton Color="Color.Primary" @onclick="OnBackClicked">Back</MudButton>
    @if (SelectedCredential != null)
    {
        <MudButton Color="Color.Secondary" @onclick="OnNextClicked">Next</MudButton>
    }
    else
    {
        <MudButton @onclick="OnCreateClicked" Color="Color.Secondary">Create New?</MudButton>
    }
</MudButtonGroup>

@code {
    [Parameter]
    public string Host { get; set; } = ServerModel.HostingProviderEnum.Rumble.ToString();
    public RumbleModel SelectedCredential { get; set; }

    protected override void OnInitialized()
    {
        base.OnInitialized();
    }

    public void OnBackClicked()
    {
        Navigation.NavigateTo("/create/select-server-host");
    }
    public void OnCreateClicked()
    {
        if (SelectedCredential ==  null)
        {
            string from = $"/create/select-server-host-credentials/{Host}";
            Navigation.NavigateTo($"/credentials/{Host}?from={from}&redirect={from}");
        }
    }

    public void OnNextClicked()
    {
        ProfileFactory.Credentials.Add(SelectedCredential);
        string from = "/create/select-server-host-credentials/Rumble";
        Navigation.NavigateTo($"/hosting/Rumble?from={from}");
    }
}
