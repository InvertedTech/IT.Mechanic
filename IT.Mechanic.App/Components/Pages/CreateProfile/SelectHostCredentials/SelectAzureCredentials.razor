@using IT.Mechanic.App.Services.Profiles
@using IT.Mechanic.App.Services.Settings
@using IT.Mechanic.Models.Configuration
@using IT.Mechanic.Models.Configuration.App
@using IT.Mechanic.Models.Configuration.Credentials
@page "/create/select-server-host-credentials/Azure"
@inject IProfileFactory ProfileFactory;
@inject ICredentialService CredentialService;
@inject NavigationManager Navigation;

<MudPaper Width="75%" Class="ml-auto mr-auto">
    <MudCard Elevation="20">
        <MudCardHeader>
            <MudText Typo="Typo.h4">Select Azure Credentials</MudText>
        </MudCardHeader>
        <MudCardContent>
            <MudSelect T="AzureModel" Label="Azure Credentials" @bind-Value="SelectedCredential">
                @foreach (var credentialRecord in CredentialService.CredentialsState.AzureCredentials)
                {
                    <MudSelectItem Value="@credentialRecord.Credentials">@credentialRecord.CredentialName</MudSelectItem>
                }
            </MudSelect>
        </MudCardContent>
        <MudCardActions>
            <MudButton Color="Color.Primary" @onclick="OnBackClicked">Back</MudButton>
            <MudButton Color="Color.Secondary" @onclick="OnCreateClicked">Create</MudButton>
            <MudButton Color="Color.Primary" @onclick="OnNextClicked" Disabled="SelectedCredential == null">Next</MudButton>
        </MudCardActions>
    </MudCard>
</MudPaper>

@code {
    public AzureModel SelectedCredential { get; set; }

    public void OnBackClicked()
    {
        Navigation.NavigateTo("/create/select-server-host");
    }

    public void OnNextClicked()
    {
        ProfileFactory.Credentials.Add(SelectedCredential);
        Navigation.NavigateTo("/hosting/azure");
    }

    public void OnCreateClicked()
    {
        Navigation.NavigateTo("/credentials/Azure");
    }
}
